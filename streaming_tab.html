<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--原網站 css 無修改 -->
    <link rel="stylesheet" href="css/clientlib-base.min.css" />
    <link rel="stylesheet" href="css/main.min.css" />
    <link rel="stylesheet" href="css/base_all.css" />
    <link rel="stylesheet" href="css/index.css" />
    <!--原網站 css 無修改 -->
    <!-- 新增 start -->
    <link rel="stylesheet" href="css/tab.css" />
    <!-- 新增 end -->
  </head>
  <body>
    <!--更新當有多筆tab時的判斷-->
    <!-- 第一組tab -->
    <div class="tab">
      <div class="tabBar">
        <div class="component_layout">
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-container">
            <div class="swiper-wrapper">
              <div class="swiper-slide active"><a class="item">INTELLECTUAL PROPERTY</a></div>
              <div class="swiper-slide"><a class="item">LICENSED MERCHANDISE</a></div>
              <div class="swiper-slide"><a class="item">ANIMATION</a></div>
              <div class="swiper-slide"><a class="item">LICENSED MERCHANDISE</a></div>
              <div class="swiper-slide"><a class="item">LICENSED MERCHANDISE</a></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tabListContentBox">
        <div class="tabListContent active">
          <div class="component_layout">A</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">B</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">C</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">D</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">E</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">F</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">G</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">H</div>
        </div>
      </div>
    </div>
    <!-- 第一組tab -->

    <!-- 測試用可移除 -->
    <div style="height: 200px"></div>
    <!-- 測試用可移除 -->

    <!-- 第二組tab -->
    <div class="tab">
      <div class="tabBar">
        <div class="component_layout">
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-container">
            <div class="swiper-wrapper">
              <div class="swiper-slide active"><a>typeA</a></div>
              <div class="swiper-slide"><a>typeB</a></div>
              <div class="swiper-slide"><a>typeC</a></div>
              <div class="swiper-slide"><a>typeD</a></div>
              <div class="swiper-slide"><a>EEEEEEEEEEEEEE</a></div>
              <div class="swiper-slide"><a>FFFFFFFFFFFFFF</a></div>
              <div class="swiper-slide"><a>GGGGGGGGGGGGGG</a></div>
              <div class="swiper-slide"><a>HHHHHHHHHHHHHH</a></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tabListContentBox">
        <div class="tabListContent active">
          <div class="component_layout">A</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">B</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">C</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">D</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">E</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">F</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">G</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">H</div>
        </div>
      </div>
    </div>
    <!-- 第二組tab -->

    <!-- 測試用可移除 -->
    <div style="height: 200px"></div>
    <!-- 測試用可移除 -->

    <!-- 第三組tab -->
    <div class="tab">
      <div class="tabBar">
        <div class="component_layout">
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-container">
            <div class="swiper-wrapper">
              <div class="swiper-slide active"><a>typeA</a></div>
              <div class="swiper-slide"><a>typeB</a></div>
              <div class="swiper-slide"><a>typeC</a></div>
              <div class="swiper-slide"><a>typeD</a></div>
              <div class="swiper-slide"><a>EEEEEEEEEEEEEE</a></div>
              <div class="swiper-slide"><a>FFFFFFFFFFFFFF</a></div>
              <div class="swiper-slide"><a>GGGGGGGGGGGGGG</a></div>
              <div class="swiper-slide"><a>HHHHHHHHHHHHHH</a></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tabListContentBox">
        <div class="tabListContent active">
          <div class="component_layout">A</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">B</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">C</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">D</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">E</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">F</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">G</div>
        </div>

        <div class="tabListContent">
          <div class="component_layout">H</div>
        </div>
      </div>
    </div>
    <!-- 第三組tab -->

    <!-- 測試用可移除 -->
    <div style="height: 1000px"></div>
    <!-- 測試用可移除 -->

    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    <script>
      (function () {
        let tab = document.querySelectorAll('.tab');

        tab?.forEach((tabItem, index) => {
          tabItem.classList.add(`tab${index}`);

          let swiperBar = new Swiper(`.tab${index} .tabBar .swiper-container`, {
            slidesPerView: 'auto',
            spaceBetween: 20,
            navigation: {
              nextEl: `.tab${index} .tabBar .swiper-button-next`,
              prevEl: `.tab${index} .tabBar .swiper-button-prev`,
            },
            slideToClickedSlide: true,
          });

          let bar = document.querySelectorAll(`.tab${index} .tabBar .swiper-slide`);
          let tabBox = document.querySelectorAll(`.tab${index} .tabListContent`);
          let tabContentBox = document.querySelector(`.tab${index} .tabListContentBox`);

          bar?.forEach((item, itemIndex) => {
            item.addEventListener('click', function () {
              let siblings = [...item.parentNode.children].filter((child) => child !== item);
              siblings.forEach((v, i) => {
                v.classList.remove('active');
              });
              tabBox.forEach((v, i) => {
                v.classList.remove('active');
              });

              this.classList.add('active');
              tabBox[itemIndex].classList.add('active');
            });
          });

          let tabBar = document.querySelector(`.tab${index} .tabBar`);
          let tabBarTop;
          let tabContentBoxHeight;

          let checkTabTop = () => {
            tabBar.classList.remove('fixed');
            tabBarTop = tabBar.offsetTop;
            tabContentBoxHeight = tabContentBox.clientHeight;
          };

          window.addEventListener('load', checkTabTop);
          window.addEventListener('resize', checkTabTop);

          let scrollTarget = () => {
            let windowScroll = window.scrollY;
            let check = false;
            if (windowScroll > tabBarTop && windowScroll < tabBarTop + tabContentBoxHeight && !check) {
              tabBar.classList.add('fixed');
              check = true;
            } else {
              check = false;
              tabBar.classList.remove('fixed');
            }
          };
          window.addEventListener('scroll', scrollTarget);
        });
      })();
    </script>
  </body>
</html>
